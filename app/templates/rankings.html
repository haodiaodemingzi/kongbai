{% extends "base.html" %}

{% block title %}战绩统计系统 - 玩家排名{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="text-center mb-4">玩家战绩排名</h1>
    
    <!-- 上传文件按钮 -->
    <div class="text-center mb-4">
        <a href="{{ url_for('battle.upload_file') }}" class="btn btn-primary">
            <i class="fas fa-upload"></i> 上传战斗日志
        </a>
        {% if players %}
        <a href="{{ url_for('battle.export_json', faction=current_faction) }}" class="btn btn-success ms-2">
            <i class="fas fa-file-download"></i> 导出JSON
        </a>
        {% endif %}
    </div>
    
    <!-- 势力筛选 -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">按势力筛选</h4>
        </div>
        <div class="card-body">
            <div class="d-flex justify-content-center">
                <a href="{{ url_for('battle.rankings') }}" class="btn {% if not current_faction %}btn-primary{% else %}btn-outline-primary{% endif %} me-2">
                    全部
                </a>
                {% for faction in factions %}
                <a href="{{ url_for('battle.rankings', faction=faction) }}" class="btn {% if current_faction == faction %}btn-primary{% else %}btn-outline-primary{% endif %} me-2">
                    {{ faction }}
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- 排名表格 -->
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
                {% if current_faction %}{{ current_faction }}{% else %}全部{% endif %} 玩家排名
            </h4>
        </div>
        <div class="card-body">
            {% if players %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>排名</th>
                            <th>玩家</th>
                            <th>职业</th>
                            <th>势力</th>
                            <th>击杀</th>
                            <th>死亡</th>
                            <th>K/D比</th>
                            <th>祝福</th>
                            <th>总分</th>
                            <th>详情</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for player in players %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td><a href="{{ url_for('battle.player_details', person_id=player.id) }}">{{ player.name|default('未知', true) }}</a></td>
                            <td>{{ player.job|default('未知', true) }}</td>
                            <td>{{ player.god|default('未知', true) }}</td>
                            <td class="text-success fw-bold">{{ player.kills|int }}</td>
                            <td class="text-danger fw-bold">{{ player.deaths|int }}</td>
                            <td>{{ player.kd_ratio }}</td>
                            <td>{% if player.blessings %}{% for i in range(player.blessings|int) %}&#x1F3EE;{% endfor %}{% else %}0{% endif %}</td>
                            <td>{{ player.score|int }}</td>
                            <td>
                                <a href="{{ url_for('battle.player_details', person_id=player.id) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-info-circle"></i> 详情
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info">
                还没有战斗记录，请上传战斗日志。
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %} 